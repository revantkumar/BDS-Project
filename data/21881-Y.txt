Companies need to pay more to a foreign workers. I am also a software engineer, and my company pay for the laywer and process fees for my H1B application and green card application. OPT workers is not cheap labor, we earn AS MUCH AS YOU DO, if not more. 
What's more, it's very rare for a software company to lay off somebody, except when the company is going downside, in which situation a software engineer can easily find a job in another company. The only reason that you retire early is because YOU ARE NOT A GOOD SOFTWARE ENGINEER!
If a company lay you off just because you're a US citizen, which is ridiculous, you can definitely sue the company of discrimination instead of making meaningless complaints here.